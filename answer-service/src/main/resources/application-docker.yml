server:
  port: ${SERVER_PORT:8083}          # 本地默认 8083；Docker 通过环境变量覆盖

spring:
  config:
    import:
      - optional:nacos:question-service.yaml?group=dev&namespace=dev
      - optional:nacos:datasource-question-service.yaml?group=dev&namespace=dev  # 显式导入数据源配置
  ## Nacos
  cloud:
    nacos:
      discovery:
        server-addr: ${SPRING_CLOUD_NACOS_DISCOVERY_SERVER_ADDR:}
        enabled: ${SPRING_CLOUD_NACOS_DISCOVERY_ENABLED:true}
        namespace: ${SPRING_CLOUD_NACOS_DISCOVERY_NAMESPACE}
        group: ${SPRING_CLOUD_NACOS_DISCOVERY_GROUP}
        register-enabled: true
        ephemeral: true
        heart-beat-interval: 5000
        heart-beat-timeout: 15000
      config:
        enabled: ${SPRING_CLOUD_NACOS_CONFIG_ENABLED:true}

        import-check:
          enabled: false
        server-addr: nacos:8848    # Nacos地址（容器名）
        namespace: ${SPRING_CLOUD_NACOS_CONFIG_NAMESPACE}
        group: ${SPRING_CLOUD_NACOS_CONFIG_GROUP}
        file-extension: yaml       # 配置文件格式
        # 导入Nacos中的共享配置（按需）
        extension-configs:
          - data-id: datasource-question-service.yaml
            group: dev
            refresh: true
    openfeign:
      circuitbreaker:
        enabled: true  # 确保这个开启
        group:
          enabled: true
      # 添加以下配置
      client:
        config:
          default:
            connectTimeout: 5000
            readTimeout: 10000
            loggerLevel: basic
  application:
    name: answer-service
  datasource:
    url: ${SPRING_DATASOURCE_URL:jdbc:mysql://localhost:3306/quiz?useSSL=false&useUnicode=true&characterEncoding=utf8&serverTimezone=Asia/Shanghai}
    username: ${SPRING_DATASOURCE_USERNAME:root}
    password: ${SPRING_DATASOURCE_PASSWORD:123456}
    driver-class-name: com.mysql.cj.jdbc.Driver
  jackson:
    default-property-inclusion: non_null

mybatis:
  mapper-locations: classpath*:mapper/*.xml
  type-aliases-package: com.djy.quiz.pojo.model
  configuration:
    map-underscore-to-camel-case: true

jwt:
  secret: ${JWT_SECRET:ajogjsofjscmolusojclskmsdlgoujoiafjmsldkcmdsgjioawejhnklasdclksdghasjklfnslkdfnmlkdscjsdkohganksldmnssldkcmnsdghnasdkjfmnsdklcmsdklhgjkladmclksmnjksdngmcgnfaksljfmndsklchndsjknfga}
  expireMinutes: ${JWT_EXPIRATION:24800}

cors:
  allow-origins:  "${CORS_ALLOW_ORIGINS:*}"
  allow-methods:  "${CORS_ALLOW_METHODS:GET,POST,PUT,DELETE,OPTIONS}"
  allow-headers:  "${CORS_ALLOW_HEADERS:Content-Type,Authorization}"
  allow-credentials: ${CORS_ALLOW_CREDENTIALS:false}

feign:
  circuitbreaker:
    enabled: true # 启用熔断器
  client:
    config:
      default:
        connectTimeout: 3000 # 连接超时 3 秒
        readTimeout: 5000 # 读取超时 5 秒

# Resilience4j 熔断器配置
resilience4j:
  circuitbreaker:
    instances:
      user-service: # 针对 user-service 的熔断器配置
        failureRateThreshold: 50 # 失败率阈值 50%
        slidingWindowSize: 10 # 滑动窗口 10 次请求
        slidingWindowType: COUNT_BASED # 基于请求数的滑动窗口
      question-service: # 针对 catalog-service 的熔断器配置
        failureRateThreshold: 50
        slidingWindowSize: 10
        slidingWindowType: COUNT_BASED
management:
  endpoints:
    web:
      exposure:
        include: health,info
  endpoint:
    health:
      show-details: always

# 外部服务配置（本地开发使用，生产环境使用Nacos服务发现）
services:
  user:
    url: ${SERVICES_USER_URL:http://user-service:8081}
  question:
    url: ${SERVICES_CATALOG_URL:http://question-service:8082}